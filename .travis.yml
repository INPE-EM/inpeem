os: windows
language: cpp
branches:
  only:
  - master
env:
- _INPEEM_GIT_DIR=C:\\Users\\travis\\build\\INPE-EM\\inpeem _INPEEM_TERRAME_DIR="$(pwd)/solution/3rdparty/terrame"
install:
- choco install nsis -y
before_script:
- mkdir solution
- cd solution
- mkdir tests
- mkdir 3rdparty
- cd 3rdparty
- curl -L -s -O https://github.com/TerraME/terrame/releases/download/2.0.1/terrame-2.0.1-win64.zip
- 7z x terrame-2.0.1-win64.zip
- mv terrame-2.0.1-win64 terrame
- cd ..
- cp ../build/scripts/win/inpeem-conf.bat .
script:
- cmd //C inpeem-conf.bat
- export PATH_BACKUP=$PATH
- export TME_PATH="$(pwd)/install/terrame/bin"
- export PATH=$TME_PATH:$PATH
- cd tests
- cmd //C terrame -version
- cmd //C terrame -package inpeem -test
- cd $TRAVIS_BUILD_DIR
- export PATH=$PATH_BACKUP
before_deploy:
- ls "$TRAVIS_BUILD_DIR/solution/build/installer"
- echo "$TRAVIS_BUILD_DIR/solution/build/installer"
- ls $TRAVIS_BUILD_DIR/solution/build/installer
- echo $TRAVIS_BUILD_DIR/solution/build/installer
- export INSTALLER_FILE="$(ls $TRAVIS_BUILD_DIR/solution/build/installer)"
- export INSTALLER_DIR=$TRAVIS_BUILD_DIR/solution/build/installer
- echo $INSTALLER_FILE
- echo $INSTALLER_DIR

deploy:
  provider: pages
  skip_cleanup: true
  github_token: $GITHUB_TOKEN
  verbose: true
  local_dir: "$INSTALLER_DIR"
  on:
    branch: master
